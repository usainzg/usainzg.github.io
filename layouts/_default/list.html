{{- define "main" }}

{{- if (and site.Params.profileMode.enabled .IsHome) }}
{{/* Home page with profile */}}
<section>
  <h1>{{ site.Params.profileMode.title }}</h1>
  {{- if site.Params.profileMode.subtitle }}
  <p class="subtitle">{{ site.Params.profileMode.subtitle }}</p>
  {{- end }}
  
  {{- if site.Params.profileMode.imageUrl }}
  <figure>
    <img src="{{ site.Params.profileMode.imageUrl }}" alt="{{ site.Params.profileMode.title }}" style="max-width: {{ site.Params.profileMode.imageWidth | default 200 }}px; border-radius: 50%;" />
  </figure>
  {{- end }}
  
  {{- if site.Params.profileMode.buttons }}
  <p>
    {{- range site.Params.profileMode.buttons }}
    <a href="{{ .url }}">{{ .name }}</a>
    {{- end }}
  </p>
  {{- end }}
  
  {{- if site.Params.socialIcons }}
  <p>
    {{- range site.Params.socialIcons }}
    <a href="{{ .url }}">{{ .name }}</a>{{ if not (eq (len site.Params.socialIcons) 1) }} · {{ end }}
    {{- end }}
  </p>
  {{- end }}
</section>
{{- else }}

{{- if not .IsHome | and .Title }}
<section>
  <h1>{{ .Title }}</h1>
</section>
{{- end }}

{{- if .Content }}
<section>
  {{ .Content }}
</section>
{{- end }}

{{- $pages := union .RegularPages .Sections }}

{{- if .IsHome }}
{{- $pages = where site.RegularPages "Type" "in" site.Params.mainSections }}
{{- $pages = where $pages "Params.hiddenInHomeList" "!=" "true"  }}
{{- end }}

{{- $paginator := .Paginate $pages }}

{{- if $paginator.Pages }}
<section>
  <h2>{{ if .IsHome }}Recent Posts{{ else }}Posts{{ end }}</h2>
  {{- range $index, $page := $paginator.Pages }}
  <p>
    <a href="{{ .Permalink }}">{{ .Title }}</a>
    {{- if not (.Param "hideMeta") }}
    <br/>
    <span style="font-style: italic; font-size: 0.9rem;">
      {{- if .Date }}
      {{ .Date.Format (site.Params.DateFormat | default "January 2, 2006") }}
      {{- end }}
      {{- if (ne (.Param "hideSummary") true) }}
      — {{ .Summary | plainify | htmlUnescape | truncate 120 }}
      {{- end }}
    </span>
    {{- end }}
  </p>
  {{- end }}
</section>
{{- end }}

{{- if gt $paginator.TotalPages 1 }}
<section>
  <p>
    {{- if $paginator.HasPrev }}
    <a href="{{ $paginator.Prev.URL | absURL }}">← Previous</a>
    {{- end }}
    {{- if and $paginator.HasPrev $paginator.HasNext }} | {{ end }}
    {{- if $paginator.HasNext }}
    <a href="{{ $paginator.Next.URL | absURL }}">Next →</a>
    {{- end }}
  </p>
</section>
{{- end }}

{{- end }}{{/* end profileMode */}}

{{- end }}{{- /* end main */ -}}
